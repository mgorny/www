<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta charset="utf-8"/>
<meta name="generator" content="Docutils 0.16: http://docutils.sourceforge.net/" />
<title>Evolution: UID trust extrapolation attack on OpenPGP signatures</title>
<meta name="author" content="Michał Górny" />
<meta name="dcterms.date" content="2019-01-31" />
<meta name="dcterms.rights" content="https://creativecommons.org/licenses/by/3.0/" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/">
<style type="text/css">

/* Minimal style sheet for the HTML output of Docutils.                    */
/*                                                                         */
/* :Author: Günter Milde, based on html4css1.css by David Goodger          */
/* :Id: $Id: minimal.css 8397 2019-09-20 11:09:34Z milde $               */
/* :Copyright: © 2015 Günter Milde.                                        */
/* :License: Released under the terms of the `2-Clause BSD license`_,      */
/*    in short:                                                            */
/*                                                                         */
/*    Copying and distribution of this file, with or without modification, */
/*    are permitted in any medium without royalty provided the copyright   */
/*    notice and this notice are preserved.                                */
/*                                                                         */
/*    This file is offered as-is, without any warranty.                    */
/*                                                                         */
/* .. _2-Clause BSD license: http://www.spdx.org/licenses/BSD-2-Clause     */

/* This CSS2.1_ stylesheet defines rules for Docutils elements without    */
/* HTML equivalent. It is required to make the document semantic visible. */
/*                                                                        */
/* .. _CSS2.1: http://www.w3.org/TR/CSS2                                  */
/* .. _validates: http://jigsaw.w3.org/css-validator/validator$link       */

/* alignment of text and inline objects inside block objects*/
.align-left   { text-align: left; }
.align-right  { text-align: right; }
.align-center { clear: both; text-align: center; }
.align-top    { vertical-align: top; }
.align-middle { vertical-align: middle; }
.align-bottom { vertical-align: bottom; }

/* titles */
h1.title, p.subtitle {
  text-align: center;
}
p.topic-title,
p.sidebar-title,
p.rubric,
p.admonition-title,
p.system-message-title {
  font-weight: bold;
}
h1 + p.subtitle,
h1 + p.section-subtitle {
  font-size: 1.6em;
}
h2 + p.section-subtitle { font-size: 1.28em; }
p.subtitle,
p.section-subtitle,
p.sidebar-subtitle {
  font-weight: bold;
  margin-top: -0.5em;
}
p.sidebar-title,
p.rubric {
  font-size: larger;
}
p.rubric { color: maroon; }
a.toc-backref {
  color: black;
  text-decoration: none; }

/* Warnings, Errors */
div.caution p.admonition-title,
div.attention p.admonition-title,
div.danger p.admonition-title,
div.error p.admonition-title,
div.warning p.admonition-title,
div.system-messages h1,
div.error,
span.problematic,
p.system-message-title {
  color: red;
}

/* inline literals */
span.docutils.literal {
  font-family: monospace;
  white-space: pre-wrap;
}
/* do not wraph at hyphens and similar: */
.literal > span.pre { white-space: nowrap; }

/* Lists */

/* compact and simple lists: no margin between items */
.simple  li, .compact li,
.simple  ul, .compact ul,
.simple  ol, .compact ol,
.simple > li p, .compact > li p,
dl.simple > dd, dl.compact > dd {
  margin-top: 0;
  margin-bottom: 0;
}

/* Table of Contents */
div.topic.contents { margin: 0.5em 0; }
div.topic.contents ul {
  list-style-type: none;
  padding-left: 1.5em;
}

/* Enumerated Lists */
ol.arabic     { list-style: decimal }
ol.loweralpha { list-style: lower-alpha }
ol.upperalpha { list-style: upper-alpha }
ol.lowerroman { list-style: lower-roman }
ol.upperroman { list-style: upper-roman }

dt span.classifier { font-style: italic }
dt span.classifier:before {
  font-style: normal;
  margin: 0.5em;
  content: ":";
}

/* Field Lists and drivatives */
/* bold field name, content starts on the same line */
dl.field-list > dt,
dl.option-list > dt,
dl.docinfo > dt,
dl.footnote > dt,
dl.citation > dt {
  font-weight: bold;
  clear: left;
  float: left;
  margin: 0;
  padding: 0;
  padding-right: 0.5em;
}
/* Offset for field content (corresponds to the --field-name-limit option) */
dl.field-list > dd,
dl.option-list > dd,
dl.docinfo > dd {
  margin-left:  9em; /* ca. 14 chars in the test examples */
}
/* start field-body on a new line after long field names */
dl.field-list > dd > *:first-child,
dl.option-list > dd > *:first-child
{
  display: inline-block;
  width: 100%;
  margin: 0;
}
/* field names followed by a colon */
dl.field-list > dt:after,
dl.docinfo > dt:after {
  content: ":";
}

/* Bibliographic Fields (docinfo) */
pre.address { font: inherit; }
dd.authors > p { margin: 0; }

/* Option Lists */
dl.option-list { margin-left: 1.5em; }
dl.option-list > dt { font-weight: normal; }
span.option { white-space: nowrap; }

/* Footnotes and Citations  */
dl.footnote.superscript > dd {margin-left: 1em; }
dl.footnote.brackets > dd {margin-left: 2em; }
dl > dt.label { font-weight: normal; }
a.footnote-reference.brackets:before,
dt.label > span.brackets:before { content: "["; }
a.footnote-reference.brackets:after,
dt.label > span.brackets:after { content: "]"; }
a.footnote-reference.superscript,
dl.footnote.superscript > dt.label {
  vertical-align: super;
  font-size: smaller;
}
dt.label > span.fn-backref { margin-left: 0.2em; }
dt.label > span.fn-backref > a { font-style: italic; }

/* Line Blocks */
div.line-block { display: block; }
div.line-block div.line-block {
  margin-top: 0;
  margin-bottom: 0;
  margin-left: 40px;
}

/* Figures, Images, and Tables */
.figure.align-left,
figure.align-left,
img.align-left,
object.align-left,
table.align-left {
  margin-right: auto;
}
.figure.align-center,
figure.align-center,
img.align-center,
object.align-center,
table.align-center {
  margin-left: auto;
  margin-right: auto;
}
.figure.align-right,
figure.align-right,
img.align-right,
object.align-right,
table.align-right {
  margin-left: auto;
}
.figure.align-center, .figure.align-right,
figure.align-center, figure.align-right,
img.align-center, img.align-right,
object.align-center, object.align-right {
  display: block;
}
/* reset inner alignment in figures and tables */
.figure.align-left, .figure.align-right,
figure.align-left, figure.align-right,
table.align-left, table.align-center, table.align-right {
  text-align: inherit;
}

/* Admonitions and System Messages */
div.admonition,
div.system-message,
div.sidebar,
aside.sidebar {
  margin: 1em 1.5em;
  border: medium outset;
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  padding-right: 1em;
  padding-left: 1em;
}

/* Sidebar */
div.sidebar,
aside.sidebar {
  width: 30%;
  max-width: 26em;
  float: right;
  clear: right;
}

/* Text Blocks */
blockquote,
div.topic,
pre.literal-block,
pre.doctest-block,
pre.math,
pre.code {
  margin-left: 1.5em;
  margin-right: 1.5em;
}
pre.code .ln { color: gray; } /* line numbers */

/* Tables */
table { border-collapse: collapse; }
td, th {
  border-style: solid;
  border-color: silver;
  padding: 0 1ex;
  border-width: thin;
}
td > p:first-child, th > p:first-child { margin-top: 0; }
td > p, th > p { margin-bottom: 0; }

table > caption {
  text-align: left;
  margin-bottom: 0.25em
}

table.borderless td, table.borderless th {
  border: 0;
  padding: 0;
  padding-right: 0.5em /* separate table cells */
}

/* Document Header and Footer */
/* div.header,				      */
/* header { border-bottom: 1px solid black; } */
/* div.footer,				      */
/* footer { border-top: 1px solid black; }    */

/* new HTML5 block elements: set display for older browsers */
header, section, footer, aside, nav, main, article, figure {
  display: block;
}

</style>
<style type="text/css">

/* CSS31_ style sheet for the output of Docutils HTML writers.             */
/* Rules for easy reading and pre-defined style variants.		   */
/*                                                                         */
/* :Author: Günter Milde, based on html4css1.css by David Goodger          */
/* :Id: $Id: plain.css 8397 2019-09-20 11:09:34Z milde $               */
/* :Copyright: © 2015 Günter Milde.                                        */
/* :License: Released under the terms of the `2-Clause BSD license`_,      */
/*    in short:                                                            */
/*                                                                         */
/*    Copying and distribution of this file, with or without modification, */
/*    are permitted in any medium without royalty provided the copyright   */
/*    notice and this notice are preserved.                                */
/*    	     	      	     	 					   */
/*    This file is offered as-is, without any warranty.                    */
/*                                                                         */
/* .. _2-Clause BSD license: http://www.spdx.org/licenses/BSD-2-Clause     */
/* .. _CSS3: http://www.w3.org/TR/CSS3		        		   */


/* Document Structure */
/* ****************** */

/* "page layout" */
body {
  margin: 0;
  background-color: #dbdbdb;
}
div.document,
main {
  line-height:1.3;
  counter-reset: table;
  /* counter-reset: figure; */
  /* avoid long lines --> better reading */
  /* OTOH: lines should not be too short because of missing hyphenation, */
  max-width: 50em;
  padding: 1px 2%; /* 1px on top avoids grey bar above title (mozilla) */
  margin: auto;
  background-color: white;
}

/* Sections */

/* Transitions */

hr.docutils {
  width: 80%;
  margin-top: 1em;
  margin-bottom: 1em;
  clear: both;
}

/* Paragraphs */
/* ========== */

/* vertical space (parskip) */
p, ol, ul, dl,
div.line-block,
div.topic,
table {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}
p:first-child { margin-top: 0; }
/* (:last-child is new in CSS 3) */
p:last-child  { margin-bottom: 0; }

h1, h2, h3, h4, h5, h6,
dl > dd {
  margin-bottom: 0.5em;
}

/* Lists */
/* ===== */

/* Definition Lists */

/* lists nested in definition lists */
/* (:only-child is new in CSS 3) */
dd > ul:only-child, dd > ol:only-child { padding-left: 1em; }

/* Description Lists */
/* styled like in most dictionaries, encyclopedias etc. */
dl.description > dt {
  font-weight: bold;
  clear: left;
  float: left;
  margin: 0;
  padding: 0;
  padding-right: 0.5em;
}

/* Field Lists */

/* example for custom field-name width */
dl.field-list.narrow > dd {
  margin-left: 5em;
}
/* run-in: start field-body on same line after long field names */
dl.field-list.run-in > dd p {
  display: block;
}

/* Bibliographic Fields */

/* generally, bibliographic fields use special definition list dl.docinfo */
/* but dedication and abstract are placed into "topic" divs */
div.abstract p.topic-title {
  text-align: center;
}
div.dedication {
  margin: 2em 5em;
  text-align: center;
  font-style: italic;
}
div.dedication p.topic-title {
  font-style: normal;
}

/* Citations */
dl.citation dt.label {
  font-weight: bold;
}
span.fn-backref {
  font-weight: normal;
}

/* Text Blocks */
/* =========== */

/* Literal Blocks */

pre.literal-block,
pre.doctest-block,
pre.math,
pre.code {
  font-family: monospace;
}

/* Block Quotes */

blockquote > table,
div.topic > table {
  margin-top: 0;
  margin-bottom: 0;
}
blockquote p.attribution,
div.topic p.attribution {
  text-align: right;
  margin-left: 20%;
}

/* Tables */
/* ====== */

/* th { vertical-align: bottom; } */

table tr { text-align: left; }

/* "booktabs" style (no vertical lines) */
table.booktabs {
  border: 0;
  border-top: 2px solid;
  border-bottom: 2px solid;
  border-collapse: collapse;
}
table.booktabs * {
  border: 0;
}
table.booktabs th {
  border-bottom: thin solid;
}

/* numbered tables (counter defined in div.document) */
table.numbered > caption:before {
  counter-increment: table;
  content: "Table " counter(table) ": ";
  font-weight: bold;
}

/* Explicit Markup Blocks */
/* ====================== */

/* Footnotes and Citations */
/* ----------------------- */

/* line on the left */
dl.footnote {
  padding-left: 1ex;
  border-left: solid;
  border-left-width: thin;
}

/* Directives */
/* ---------- */

/* Body Elements */
/* ~~~~~~~~~~~~~ */

/* Images and Figures */

/* let content flow to the side of aligned images and figures */
.figure.align-left,
figure.align-left,
img.align-left,
object.align-left {
  display: block;
  clear: left;
  float: left;
  margin-right: 1em;
}
.figure.align-right,
figure.align-right,
img.align-right,
object.align-right {
  display: block;
  clear: right;
  float: right;
  margin-left: 1em;
}
/* Stop floating sidebars, images and figures at section level 1,2,3 */
h1, h2, h3 { clear: both; }

/* Sidebar */

/* Move right. In a layout with fixed margins, */
/* it can be moved into the margin.   	       */
div.sidebar,
aside.sidebar {
  width: 30%;
  max-width: 26em;
  margin-left: 1em;
  margin-right: -2%;
  background-color: #ffffee;
}

/* Code */

pre.code { padding: 0.7ex }
pre.code, code { background-color: #eeeeee }
pre.code .ln { color: gray; } /* line numbers */
/* basic highlighting: for a complete scheme, see */
/* http://docutils.sourceforge.net/sandbox/stylesheets/ */
pre.code .comment, code .comment { color: #5C6576 }
pre.code .keyword, code .keyword { color: #3B0D06; font-weight: bold }
pre.code .literal.string, code .literal.string { color: #0C5404 }
pre.code .name.builtin, code .name.builtin { color: #352B84 }
pre.code .deleted, code .deleted { background-color: #DEB0A1}
pre.code .inserted, code .inserted { background-color: #A3D289}

/* Math */
/* styled separately (see math.css for math-output=HTML) */

/* Epigraph           */
/* Highlights         */
/* Pull-Quote         */
/* Compound Paragraph */
/* Container          */

/* can be styled in a custom stylesheet */

/* Document Header and Footer */

footer, header,
div.footer, div.header {
  font-size: smaller;
  clear: both;
  padding: 0.5em 2%;
  background-color: #ebebee;
  border: none;
}

/* Inline Markup */
/* ============= */

/* Emphasis           */
/*   em               */
/* Strong Emphasis    */
/*   strong	      */
/* Interpreted Text   */
/*   span.interpreted */
/* Title Reference    */
/*   cite	      */

/* Inline Literals                                          */
/* possible values: normal, nowrap, pre, pre-wrap, pre-line */
/*   span.docutils.literal { white-space: pre-wrap; }       */

/* Hyperlink References */
a { text-decoration: none; }

/* External Targets       */
/*   span.target.external */
/* Internal Targets  	  */
/*   span.target.internal */
/* Footnote References    */
/*   a.footnote-reference */
/* Citation References    */
/*   a.citation-reference */

</style>
</head>
<body>
<div class="document" id="evolution-uid-trust-extrapolation-attack-on-openpgp-signatures">
<h1 class="title">Evolution: UID trust extrapolation attack on OpenPGP signatures</h1>
<dl class="docinfo simple">
<dt class="author">Author</dt>
<dd class="author"><p>Michał Górny</p></dd>
<dt class="date">Date</dt>
<dd class="date">2019-01-31</dd>
<dt class="version">Version</dt>
<dd class="version">1.0</dd>
<dt class="copyright">Copyright</dt>
<dd class="copyright"><a class="reference external" href="https://creativecommons.org/licenses/by/3.0/">https://creativecommons.org/licenses/by/3.0/</a></dd>
</dl>
<div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#abstract" id="id4">Abstract</a></p></li>
<li><p><a class="reference internal" href="#background" id="id5">Background</a></p>
<ul>
<li><p><a class="reference internal" href="#uid-oriented-trust-model" id="id6">UID-oriented trust model</a></p></li>
<li><p><a class="reference internal" href="#gnupg-signature-verification" id="id7">GnuPG Signature verification</a></p></li>
<li><p><a class="reference internal" href="#the-signature-check-ui-in-evolution" id="id8">The signature check UI in Evolution</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#summary" id="id9">Summary</a></p></li>
<li><p><a class="reference internal" href="#impact" id="id10">Impact</a></p></li>
<li><p><a class="reference internal" href="#solution" id="id11">Solution</a></p></li>
<li><p><a class="reference internal" href="#detailed-outline-of-the-test-case" id="id12">Detailed outline of the test case</a></p></li>
<li><p><a class="reference internal" href="#references" id="id13">References</a></p></li>
<li><p><a class="reference internal" href="#comments" id="id14">Comments</a></p></li>
</ul>
</div>
<div class="section" id="abstract">
<h1><a class="toc-backref" href="#id4">Abstract</a></h1>
<p>This article describes the UI deficiency of Evolution mail client that
extrapolates the trust of one of OpenPGP key UIDs into the key itself,
and reports it along with the (potentially untrusted) primary UID.  This
creates the possibility of tricking the user into trusting a phished
mail via adding a forged UID to a key that has a previously trusted UID.</p>
</div>
<div class="section" id="background">
<h1><a class="toc-backref" href="#id5">Background</a></h1>
<div class="section" id="uid-oriented-trust-model">
<h2><a class="toc-backref" href="#id6">UID-oriented trust model</a></h2>
<p>The commonly used OpenPGP trust models are UID-oriented.  That is, they
are based on establishing validity of individual UIDs associated with
a particular key rather than the key as a whole.  For example,
in the Web-of-Trust model individuals certify the validity of UIDs they
explicitly verified.</p>
<p>Any new UID added to the key is appropriately initially untrusted.  This
is understandable since the key holder is capable of adding arbitrary
UIDs to the key, and there is no guarantee that new UID will not
actually be an attempt at forging somebody else's identity.</p>
</div>
<div class="section" id="gnupg-signature-verification">
<h2><a class="toc-backref" href="#id7">GnuPG Signature verification</a></h2>
<p>OpenPGP signatures do not provide any connection between the signature
and the UID of the sender.  While technically the signature packet
permits specifying UID, it is used only to facilitate finding the key,
and is not guaranteed to be meaningful.  Instead, only the signing key
can be derived from the signature in cryptographically proven way.</p>
<p>GnuPG (as of version 2.2.12) does not provide any method of associating
the apparent UID (e.g. from e-mail's <span class="docutils literal">From</span> header) against
the signature.  Instead, only the signature itself is passed to GnuPG
and its apparent trust is extrapolated from validity of different UIDs
on the key.  In other words, the signature is considered to be made with
a trusted key if at least one of the UIDs has been verified.</p>
<p>An example user-oriented output from such a verification lists UIDs
on the key along with their respective validity:</p>
<pre class="literal-block">gpg: Signature made sob, 26 sty 2019, 09:01:16 CET
gpg:                using RSA key EDA1165366204A694417B2FC551A87083FDCFBF0
gpg: Good signature from &quot;Alice &lt;alice&#64;example.com&gt;&quot; [unknown]
gpg:                 aka &quot;Eve &lt;eve&#64;example.com&gt;&quot; [full]</pre>
<p>However, the machine-oriented output provided to <span class="docutils literal"><span class="pre">--status-fd</span></span> is not
this verbose:</p>
<pre class="literal-block">[GNUPG:] NEWSIG
[GNUPG:] KEY_CONSIDERED EDA1165366204A694417B2FC551A87083FDCFBF0 0
[GNUPG:] SIG_ID dbb5pG09OgJI0cRPGjqs2ZFAqyw 2019-01-26 1548489676
[GNUPG:] KEY_CONSIDERED EDA1165366204A694417B2FC551A87083FDCFBF0 0
[GNUPG:] GOODSIG 551A87083FDCFBF0 Alice &lt;alice&#64;example.com&gt;
[GNUPG:] VALIDSIG EDA1165366204A694417B2FC551A87083FDCFBF0 2019-01-26 1548489676 0 4 0 1 8 01 EDA1165366204A694417B2FC551A87083FDCFBF0
[GNUPG:] KEY_CONSIDERED EDA1165366204A694417B2FC551A87083FDCFBF0 0
[GNUPG:] TRUST_FULLY 0 pgp
[GNUPG:] VERIFICATION_COMPLIANCE_MODE 23</pre>
<p>Specifically, note that this output includes:</p>
<ul class="simple">
<li><p>the key's primary UID (without its validity) in <span class="docutils literal">GOODSIG</span>,</p></li>
<li><p>the key's full fingerprint in <span class="docutils literal">VALIDSIG</span>,</p></li>
<li><p>the key's extrapolated trust in <span class="docutils literal">TRUST_*</span>.  <a class="footnote-reference brackets" href="#gnupg-details" id="id1">1</a></p></li>
</ul>
<p>As such, this output is not only unsuitable to verify whether the UID
used to send the message is trusted but also is not proof to mistakenly
associating the extrapolated trust with the primary UID provided
in output.</p>
</div>
<div class="section" id="the-signature-check-ui-in-evolution">
<h2><a class="toc-backref" href="#id8">The signature check UI in Evolution</a></h2>
<p>The Evolution mail client (as of version 3.26.6) converts the
machine-oriented GnuPG output into a user-friendly status bar.  This bar
indicates the signature check result using an explanatory message
and background color (red for failed verification, yellow for untrusted
signatures, green for trusted signatures).  It also includes the primary
UID of the key used to make the signature, and a button bringing
complete GnuPG output.</p>
<p>The signature bars for an example trusted and untrusted signatures
are presented below:</p>
<img alt="evolution-uid-trust-extrapolation/trusted-sig.png" src="evolution-uid-trust-extrapolation/trusted-sig.png" />
<img alt="evolution-uid-trust-extrapolation/untrusted-sig.png" src="evolution-uid-trust-extrapolation/untrusted-sig.png" />
<p>This status bar is created directly from the <span class="docutils literal"><span class="pre">--status-fd</span></span> output
presented above.  It combines the indicated key trust with the primary
UID of the key used to make the signature, independently of the UID's
validity itself.</p>
</div>
</div>
<div class="section" id="summary">
<h1><a class="toc-backref" href="#id9">Summary</a></h1>
<p>The attack is based on using the deficiency of Evolution UI when
handling new identifiers on previously trusted keys to convince the user
to trust a phishing attempt.  Please consider the following example:</p>
<p>Alice, Bob and Eve are all using OpenPGP, and they all have a single UID
on their key corresponding to their legitimate identity.  Through Bob's
Web-of-Trust, both Alice's and Eve's primary identifiers are trusted.</p>
<p>Now, Eve creates a new identifier that resembles the one belonging to
Alice, and sets it as her primary identifier.  Afterwards, she sends
an e-mail to Bob, with Alice's e-mail address in the <span class="docutils literal">From</span> field,
signed with her own key.  Evolution displays the mail as presented
in the following screenshot:</p>
<img alt="evolution-uid-trust-extrapolation/forged-mail.png" src="evolution-uid-trust-extrapolation/forged-mail.png" />
<p>Specifically, please note that the message <cite>Valid signature (Alice
&lt;alice&#64;example.com&gt;)</cite> suggests that they mail has been signed with
a trusted key belonging to Alice.  However, the detailed output
reveals that the only trusted UID in the key belongs to Eve:</p>
<pre class="literal-block">gpg: Good signature from &quot;Alice &lt;alice&#64;example.com&gt;&quot; [unknown]
gpg:                 aka &quot;Eve &lt;eve&#64;example.com&gt;&quot; [full]</pre>
</div>
<div class="section" id="impact">
<h1><a class="toc-backref" href="#id10">Impact</a></h1>
<p>This method can be used to easily trick the recipient into accepting
phished mail as legitimate.  However, it has a limited scope because:</p>
<ol class="arabic simple">
<li><p>It requires the attacker's key to gain recipient's trust,
e.g. via OpenPGP WoT model.  As a result, it may require the attacker
to disclose his identity or trick additional people into accepting
a forged identity.</p></li>
<li><p>The mismatched identity is immediately apparent on key inspection,
and therefore raises suspicion as to the key holder's legitimacy.</p></li>
</ol>
</div>
<div class="section" id="solution">
<h1><a class="toc-backref" href="#id11">Solution</a></h1>
<p>The issue has been reported upstream at 2019-01-26.  However, upstream
closed the bug report, claiming that the issue needs to be resolved
on GnuPG end.  <a class="footnote-reference brackets" href="#evolution-bug-report" id="id2">2</a></p>
<p>However, the existing GnuPG API should be sufficient to resolve
the problem.  In particular, Evolution could use <span class="docutils literal"><span class="pre">--list-keys</span> <span class="pre">--with-colons</span></span> to easily determine validity of each UID corresponding
to the key:</p>
<pre class="literal-block">tru::1:1548488994:1611560841:3:1:5
pub:f:2048:1:551A87083FDCFBF0:1548488894:1611560894::-:::scESC::::::23::0:
fpr:::::::::EDA1165366204A694417B2FC551A87083FDCFBF0:
uid:-::::1548488982::AD66BA4CCE5C5EE636FAD1BE2B9A0DB88903021E::Alice &lt;alice&#64;example.com&gt;::::::::::0:
uid:f::::1548488894::A608485EB3B3D764C07C4ECDE75D90422B705C6A::Eve &lt;eve&#64;example.com&gt;::::::::::0:
sub:f:2048:1:C21F342D44257AE6:1548488894::::::e::::::23:
fpr:::::::::E4113A42D86B9D335B5D4167C21F342D44257AE6:</pre>
</div>
<div class="section" id="detailed-outline-of-the-test-case">
<h1><a class="toc-backref" href="#id12">Detailed outline of the test case</a></h1>
<p>In the following section, <cite>profiles</cite> will be used to reference
isolated directories used to store GnuPG keys and configuration.
The <span class="docutils literal">GNUPGHOME</span> environment variable is used to specify the directory
to use.</p>
<p>The issue can be easily reproduced through the following steps:</p>
<ol class="arabic">
<li><p>Create new directories that will serve as <span class="docutils literal">GNUPGHOME</span> for Alice,
Bob and Eve.</p></li>
<li><p>Create keys for Alice, Bob and Eve using their profiles.  Add
legitimate user identifier to each of them.</p></li>
<li><p>Export Alice's and Eve's keys from their profiles, and import them
into Bob's.</p></li>
<li><p>Sign Alice's and Eve's keys using Bob's key.</p></li>
<li><p>Export signed Eve's key and import it into her profile.</p></li>
<li><p>Using Eve's profile, add a new user identifier to her key.  Make
the UID resemble Alice's UID.</p></li>
<li><p>Export updated Eve's key and import it to Bob's profile.</p></li>
<li><p>Using Eve's profile, create a new signed mail in mbox format.  This
can be done e.g. via creating a text file, using <span class="docutils literal">gpg <span class="pre">--clearsign</span></span>
to sign it, then prepending e-mail headers such as:</p>
<pre class="literal-block">From localhost
From: Alice &lt;alice&#64;example.com&gt;
To: Bob &lt;bob&#64;example.com&gt;
Subject: forged message test</pre>
</li>
<li><p>Import the resulting mail into Evolution, and open it.</p></li>
</ol>
</div>
<div class="section" id="references">
<h1><a class="toc-backref" href="#id13">References</a></h1>
<dl class="footnote brackets">
<dt class="label" id="gnupg-details"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>GnuPG Details
(<a class="reference external" href="https://git.gnupg.org/cgi-bin/gitweb.cgi?p=gnupg.git;a=blob;f=doc/DETAILS;h=74a63ef007fdf1903918351ac281847098ab3828">https://git.gnupg.org/cgi-bin/gitweb.cgi?p=gnupg.git;a=blob;f=doc/DETAILS;h=74a63ef007fdf1903918351ac281847098ab3828</a>)</p>
</dd>
<dt class="label" id="evolution-bug-report"><span class="brackets"><a class="fn-backref" href="#id2">2</a></span></dt>
<dd><p>Potential vulnerability: gpg key trust
extrapolation to new UIDs · Issues · GNOME / evolution · GitLab
(<a class="reference external" href="https://gitlab.gnome.org/GNOME/evolution/issues/299">https://gitlab.gnome.org/GNOME/evolution/issues/299</a>)</p>
</dd>
</dl>
</div>
<div class="section" id="comments">
<h1><a class="toc-backref" href="#id14">Comments</a></h1>
<p>The comments to this article are maintained as part of the relevant
blog entry: <a class="reference external" href="https://blogs.gentoo.org/mgorny/2019/01/31/evolution-uid-trust-extrapolation-attack-on-openpgp-signatures/#comments">Evolution: UID trust extrapolation attack on OpenPGP
signatures</a>.</p>
</div>
</div>
</body>
</html>
